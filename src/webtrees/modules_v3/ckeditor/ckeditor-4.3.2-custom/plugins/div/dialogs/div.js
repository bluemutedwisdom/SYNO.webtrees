(function(){function a(d,c,e){if(!c.is||!c.getCustomData("block_processed")){c.is&&CKEDITOR.dom.element.setMarker(e,c,"block_processed",!0),d.push(c)}}function b(e,d){var g=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);e.config.div_wrapTable&&(delete g.td,delete g.th);var f=CKEDITOR.dtd.div,c={},h=[];return{title:e.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:e.lang.common.generalTab,title:e.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:e.lang.div.styleSelectLabel,"default":"",items:[[e.lang.common.notSet,""]],onChange:function(){var k=["info:elementStyle","info:class","advanced:dir","advanced:style"],o=this.getDialog(),m=o._element&&o._element.clone()||new CKEDITOR.dom.element("div",e.document);this.commit(m,!0);for(var k=[].concat(k),i=k.length,l,n=0;n<i;n++){(l=o.getContentElement.apply(o,k[n].split(":")))&&l.setup&&l.setup(m,!0)}},setup:function(i){for(var j in c){c[j].checkElementRemovable(i,!0)&&this.setValue(j,1)}},commit:function(i){var j;(j=this.getValue())?c[j].applyToObject(i):i.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:e.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:e.lang.common.advancedTab,title:e.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:e.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:e.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:e.lang.common.cssStyle,"default":"",commit:function(i){i.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:e.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:e.lang.common.langDir,"default":"",items:[[e.lang.common.notSet,""],[e.lang.common.langDirLtr,"ltr"],[e.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){this.foreach(function(j){if(/^(?!vbox|hbox)/.test(j.type)&&(j.setup||(j.setup=function(l){j.setValue(l.getAttribute(j.id)||"",1)}),!j.commit)){j.commit=function(l){var m=this.getValue();"dir"==j.id&&l.getComputedStyle("direction")==m||(m?l.setAttribute(j.id,m):l.removeAttribute(j.id))}}});var i=this,k=this.getContentElement("info","elementStyle");e.getStylesSet(function(m){var j,l;if(m){for(var n=0;n<m.length;n++){l=m[n],l.element&&"div"==l.element&&(j=l.name,c[j]=l=new CKEDITOR.style(l),e.filter.check(l)&&(k.items.push([j,j]),k.add(j,j)))}}k[1<k.items.length?"enable":"disable"]();setTimeout(function(){i._element&&k.setup(i._element)},0)})},onShow:function(){"editdiv"==d&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(e))},onOk:function(){if("editdiv"==d){h=[this._element]}else{var n=[],t={},p=[],u,o=e.getSelection(),r=o.getRanges(),i=o.createBookmarks(),q,l;for(q=0;q<r.length;q++){for(l=r[q].createIterator();u=l.getNextParagraph();){if(u.getName() in g&&!u.isReadOnly()){var s=u.getChildren();for(u=0;u<s.count();u++){a(p,s.getItem(u),t)}}else{for(;!f[u.getName()]&&!u.equals(r[q].root);){u=u.getParent()}a(p,u,t)}}}CKEDITOR.dom.element.clearAllMarkers(t);r=[];q=null;for(l=0;l<p.length;l++){u=p[l],s=e.elementPath(u).blockLimit,s.isReadOnly()&&(s=s.getParent()),e.config.div_wrapTable&&s.is(["td","th"])&&(s=e.elementPath(s.getParent()).blockLimit),s.equals(q)||(q=s,r.push([])),r[r.length-1].push(u)}for(q=0;q<r.length;q++){s=r[q][0];p=s.getParent();for(u=1;u<r[q].length;u++){p=p.getCommonAncestor(r[q][u])}l=new CKEDITOR.dom.element("div",e.document);for(u=0;u<r[q].length;u++){for(s=r[q][u];!s.getParent().equals(p);){s=s.getParent()}r[q][u]=s}for(u=0;u<r[q].length;u++){if(s=r[q][u],!s.getCustomData||!s.getCustomData("block_processed")){s.is&&CKEDITOR.dom.element.setMarker(t,s,"block_processed",!0),u||l.insertBefore(s),l.append(s)}}CKEDITOR.dom.element.clearAllMarkers(t);n.push(l)}o.selectBookmarks(i);h=n}n=h.length;for(t=0;t<n;t++){this.commitContent(h[t]),!h[t].getAttribute("style")&&h[t].removeAttribute("style")}this.hide()},onHide:function(){"editdiv"==d&&this._element.removeCustomData("elementStyle");delete this._element}}}CKEDITOR.dialog.add("creatediv",function(c){return b(c,"creatediv")});CKEDITOR.dialog.add("editdiv",function(c){return b(c,"editdiv")})})();