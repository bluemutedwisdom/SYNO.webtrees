CKEDITOR.plugins.add("wordcount",{lang:"ca de en es fr it jp nl no pl pt-BR ru".split(" "),version:1.09,init:function(u){function i(c){var h=document.createElement("div");h.innerHTML=c;return""==h.textContent&&"undefined"==typeof h.innerText?"0":h.textContent||h.innerText}function s(a){var h=0,k=0,b,j;if(j=a.getData()){if(v.showCharCount&&(v.countHTML?k=j.length:(u.config.fullPage&&(k=j.search(/<body>/i),-1!=k&&(b=j.search(/<\/body>/i),j=j.substring(k+6,b))),b=j.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+|\s+$/g,"").replace("&nbsp;","").replace(/\s/g,""),b=i(b).replace(/^([\s\t\r\n]*)$/,""),k=b.length)),v.showWordCount){b=j.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");b=i(b);h=b.split(/\s+/);for(j=h.length-1;0<=j;j--){h[j].match(/^([\s\t\r\n]*)$/)&&h.splice(j,1)}h=h.length}}j=d.replace("%wordCount%",h).replace("%charCount%",k);document.getElementById("cke_wordcount_"+a.name).innerHTML=j;if(k==g){return !0}g=k;v.showWordCount&&h>v.wordLimit?f(u,r):v.showWordCount&&h==v.wordLimit?a.fire("saveSnapshot"):!o&&h<v.wordLimit&&e(u);v.showCharCount&&k>v.charLimit?f(u,r):v.showCharCount&&k==v.charLimit?a.fire("saveSnapshot"):!o&&k<v.charLimit&&e(u);return !0}function f(b,h){r=!0;o=!1;b.execCommand("undo");h||b.fire("limitReached",{},u);b.config.Locked=1}function e(b){o=!0;r=!1;b.config.Locked=0;document.getElementById("cke_wordcount_"+b.name).className="cke_wordcount"}if(u.elementMode!==CKEDITOR.ELEMENT_MODE_INLINE){var t='<span class="cke_path_item">',g=0,r=!1,o=!1,v=CKEDITOR.tools.extend({showWordCount:!0,showCharCount:!1,charLimit:"unlimited",wordLimit:"unlimited",countHTML:!1},u.config.wordcount||{},!0);v.showCharCount&&(t+=u.lang.wordcount[v.countHTML?"CharCountWithHTML":"CharCount"]+"&nbsp;%charCount%","unlimited"!=v.charLimit&&(t+="&nbsp;("+u.lang.wordcount.limit+"&nbsp;"+v.charLimit+")"));v.showCharCount&&v.showWordCount&&(t+=",&nbsp;");v.showWordCount&&(t+=u.lang.wordcount.WordCount+" %wordCount%","unlimited"!=v.wordLimit&&(t+="&nbsp;("+u.lang.wordcount.limit+"&nbsp;"+v.wordLimit+")"));var d=t+"</span>";CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css");u.on("key",function(b){"source"===u.mode&&s(b.editor)},u,null,100);u.on("change",function(b){s(b.editor)},u,null,100);u.on("uiSpace",function(b){"bottom"==b.data.space&&(b.data.html+='<div id="cke_wordcount_'+b.editor.name+'" class="cke_wordcount" style="" title="'+u.lang.wordcount.title+'">&nbsp;</div>')},u,null,100);u.on("dataReady",function(b){s(b.editor)},u,null,100);u.on("afterPaste",function(b){s(b.editor)},u,null,100);u.on("blur",function(){},u,null,300);String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}}});